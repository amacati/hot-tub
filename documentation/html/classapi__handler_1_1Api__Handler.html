<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hot Tub: api_handler.Api_Handler Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="hot_tub_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Hot Tub
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceapi__handler.html">api_handler</a></li><li class="navelem"><a class="el" href="classapi__handler_1_1Api__Handler.html">Api_Handler</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="classapi__handler_1_1Api__Handler-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">api_handler.Api_Handler Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a92a87b22341ea38cbd8e1b2c842c2c92"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#a92a87b22341ea38cbd8e1b2c842c2c92">__init__</a> (self, <a class="el" href="classapi__handler_1_1Api__Handler.html#ac170bc01a8ab6cb99c9ce08179c1f5b8">api_keys</a>)</td></tr>
<tr class="separator:a92a87b22341ea38cbd8e1b2c842c2c92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80ae83a6d84bc883dad843a70d421b19"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#a80ae83a6d84bc883dad843a70d421b19">get_weather_info</a> (self, city_id)</td></tr>
<tr class="separator:a80ae83a6d84bc883dad843a70d421b19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc116754c9d203e9393ef6812aace2ab"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#acc116754c9d203e9393ef6812aace2ab">make_call_with_retries</a> (self, request_params, num_retries=3)</td></tr>
<tr class="separator:acc116754c9d203e9393ef6812aace2ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addd77c7f046a8dd4ab915c876d9b5327"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#addd77c7f046a8dd4ab915c876d9b5327">increment_calls_per_minute</a> (self)</td></tr>
<tr class="separator:addd77c7f046a8dd4ab915c876d9b5327"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:ac170bc01a8ab6cb99c9ce08179c1f5b8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#ac170bc01a8ab6cb99c9ce08179c1f5b8">api_keys</a></td></tr>
<tr class="separator:ac170bc01a8ab6cb99c9ce08179c1f5b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a196da94d94aa836138477ec9e94180ea"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#a196da94d94aa836138477ec9e94180ea">max_calls_per_minute</a></td></tr>
<tr class="separator:a196da94d94aa836138477ec9e94180ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3d8595d8d078580e05b208908b496e6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#aa3d8595d8d078580e05b208908b496e6">api_key_index</a></td></tr>
<tr class="separator:aa3d8595d8d078580e05b208908b496e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add9a2fa69fb032a9328bcc2fa768d25c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#add9a2fa69fb032a9328bcc2fa768d25c">calls_made</a></td></tr>
<tr class="separator:add9a2fa69fb032a9328bcc2fa768d25c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8bf02be35e562aa704378d449c717e5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#ae8bf02be35e562aa704378d449c717e5">api_key_index_lock</a></td></tr>
<tr class="separator:ae8bf02be35e562aa704378d449c717e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1d9e727d27ce7e9fcc440a417792832"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#ae1d9e727d27ce7e9fcc440a417792832">calls_made_lock</a></td></tr>
<tr class="separator:ae1d9e727d27ce7e9fcc440a417792832"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae09a9b7849ff07f9d98809697997be36"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#ae09a9b7849ff07f9d98809697997be36">failed_counter</a></td></tr>
<tr class="separator:ae09a9b7849ff07f9d98809697997be36"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:ab20649db83a3f9b3f1d60bb815329d0b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#ab20649db83a3f9b3f1d60bb815329d0b">CALLS_PER_KEY</a> = 60</td></tr>
<tr class="separator:ab20649db83a3f9b3f1d60bb815329d0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46175d910fb77b9c170664e6167f1982"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#a46175d910fb77b9c170664e6167f1982">URL</a> = 'https://api.openweathermap.org/data/2.5/weather?'</td></tr>
<tr class="separator:a46175d910fb77b9c170664e6167f1982"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9dcb27e5a2310e0bc1392a95ef82444"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapi__handler_1_1Api__Handler.html#ad9dcb27e5a2310e0bc1392a95ef82444">EXPECTED_API_STATUS_CODE</a> = 200</td></tr>
<tr class="separator:ad9dcb27e5a2310e0bc1392a95ef82444"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Class for handling calls to the Open Weather API from multiple threads at a
time. Will automatically maintain a minutely call limit to prevent our
account with Open Weather from being suspended.
</pre> </div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a92a87b22341ea38cbd8e1b2c842c2c92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92a87b22341ea38cbd8e1b2c842c2c92">&#9670;&nbsp;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def api_handler.Api_Handler.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>api_keys</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a80ae83a6d84bc883dad843a70d421b19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80ae83a6d84bc883dad843a70d421b19">&#9670;&nbsp;</a></span>get_weather_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def api_handler.Api_Handler.get_weather_info </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>city_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Round-robin pick an API key from the list given on instantiation and
make an API call for the given city ID. Return the result of the call.

@param city_id    ID of the city to retrieve weather information

@return the result of the API call (or none if the call failed)
</pre> 
</div>
</div>
<a id="addd77c7f046a8dd4ab915c876d9b5327"></a>
<h2 class="memtitle"><span class="permalink"><a href="#addd77c7f046a8dd4ab915c876d9b5327">&#9670;&nbsp;</a></span>increment_calls_per_minute()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def api_handler.Api_Handler.increment_calls_per_minute </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">This is the function with all the logic for rate limiting our API calls
and sleeping when appropriate. Use a dictionary - with a single entry
for the current minute - to keep track of how many calls have been made
for the current minute. If there is not an entry in the dictionary for
the current minute, then reset the dictionary and add a new entry. If
the count for the current minute is equal to the max calls per minute,
sleep until the next minute. Otherwise, increment count and return.
</pre> 
</div>
</div>
<a id="acc116754c9d203e9393ef6812aace2ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc116754c9d203e9393ef6812aace2ab">&#9670;&nbsp;</a></span>make_call_with_retries()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def api_handler.Api_Handler.make_call_with_retries </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>request_params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_retries</em> = <code>3</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Attempt and API call until successful or until the retry limit has been
reached. A successful API call is one that has a status code of 200
(AKA EXPECTED_API_STATUS_CODE). Return the result of the API call or
None if the call failed to succeed with num_retries retries.

@param request_params    parameters to send as part of the API call

@return the result of the API call or None if the call failed too many
times
</pre> 
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="aa3d8595d8d078580e05b208908b496e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3d8595d8d078580e05b208908b496e6">&#9670;&nbsp;</a></span>api_key_index</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">api_handler.Api_Handler.api_key_index</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae8bf02be35e562aa704378d449c717e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8bf02be35e562aa704378d449c717e5">&#9670;&nbsp;</a></span>api_key_index_lock</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">api_handler.Api_Handler.api_key_index_lock</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac170bc01a8ab6cb99c9ce08179c1f5b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac170bc01a8ab6cb99c9ce08179c1f5b8">&#9670;&nbsp;</a></span>api_keys</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">api_handler.Api_Handler.api_keys</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="add9a2fa69fb032a9328bcc2fa768d25c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add9a2fa69fb032a9328bcc2fa768d25c">&#9670;&nbsp;</a></span>calls_made</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">api_handler.Api_Handler.calls_made</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae1d9e727d27ce7e9fcc440a417792832"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1d9e727d27ce7e9fcc440a417792832">&#9670;&nbsp;</a></span>calls_made_lock</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">api_handler.Api_Handler.calls_made_lock</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab20649db83a3f9b3f1d60bb815329d0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab20649db83a3f9b3f1d60bb815329d0b">&#9670;&nbsp;</a></span>CALLS_PER_KEY</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int api_handler.Api_Handler.CALLS_PER_KEY = 60</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ad9dcb27e5a2310e0bc1392a95ef82444"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9dcb27e5a2310e0bc1392a95ef82444">&#9670;&nbsp;</a></span>EXPECTED_API_STATUS_CODE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int api_handler.Api_Handler.EXPECTED_API_STATUS_CODE = 200</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ae09a9b7849ff07f9d98809697997be36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae09a9b7849ff07f9d98809697997be36">&#9670;&nbsp;</a></span>failed_counter</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">api_handler.Api_Handler.failed_counter</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a196da94d94aa836138477ec9e94180ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a196da94d94aa836138477ec9e94180ea">&#9670;&nbsp;</a></span>max_calls_per_minute</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">api_handler.Api_Handler.max_calls_per_minute</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a46175d910fb77b9c170664e6167f1982"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46175d910fb77b9c170664e6167f1982">&#9670;&nbsp;</a></span>URL</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string api_handler.Api_Handler.URL = 'https://api.openweathermap.org/data/2.5/weather?'</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/api_stream/<a class="el" href="api__handler_8py.html">api_handler.py</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
